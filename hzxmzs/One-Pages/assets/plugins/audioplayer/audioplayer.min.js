/*
	AUTHOR: Osvaldas Valutis, www.osvaldas.info
*/

!function(a,b,c,d){var e="ontouchstart"in b,f=e?"touchstart":"mousedown",g=e?"touchmove":"mousemove",i=e?"touchcancel":"mouseup",j=function(a){var b=a/3600,c=Math.floor(b),d=a%3600/60,e=Math.floor(d),f=Math.ceil(a%3600%60);return f>59&&(f=0,e=Math.ceil(d)),e>59&&(e=0,c=Math.ceil(b)),(0==c?"":c>0&&c.toString().length<2?"0"+c+":":c+":")+(e.toString().length<2?"0"+e:e)+":"+(f.toString().length<2?"0"+f:f)},k=function(a){var b=c.createElement("audio");return!(!b.canPlayType||!b.canPlayType("audio/"+a.split(".").pop().toLowerCase()+";").replace(/no/,""))};a.fn.audioPlayer=function(b){var b=a.extend({classPrefix:"audioplayer",strPlay:"Play",strPause:"Pause",strVolume:"Volume"},b),c={},d={playPause:"playpause",playing:"playing",stopped:"stopped",time:"time",timeCurrent:"time-current",timeDuration:"time-duration",bar:"bar",barLoaded:"bar-loaded",barPlayed:"bar-played",volume:"volume",volumeButton:"volume-button",volumeAdjust:"volume-adjust",noVolume:"novolume",muted:"muted",mini:"mini"};for(var h in d)c[h]=b.classPrefix+"-"+d[h];return this.each(function(){if("audio"!=a(this).prop("tagName").toLowerCase())return!1;var d=a(this),h=d.attr("src"),l=d.get(0).getAttribute("autoplay"),l=""===l||"autoplay"===l,m=d.get(0).getAttribute("loop"),m=""===m||"loop"===m,n=!1;"undefined"==typeof h?d.find("source").each(function(){if(h=a(this).attr("src"),"undefined"!=typeof h&&k(h))return n=!0,!1}):k(h)&&(n=!0);var o=a('<div class="'+b.classPrefix+'">'+(n?a("<div>").append(d.eq(0).clone()).html():'<embed src="'+h+'" width="0" height="0" volume="100" autostart="'+l.toString()+'" loop="'+m.toString()+'" />')+'<div class="'+c.playPause+'" title="'+b.strPlay+'"><a href="#">'+b.strPlay+"</a></div></div>"),p=n?o.find("audio"):o.find("embed"),p=p.get(0);if(n){o.find("audio").css({width:0,height:0,visibility:"hidden"}),o.append('<div class="'+c.time+" "+c.timeCurrent+'"></div><div class="'+c.bar+'"><div class="'+c.barLoaded+'"></div><div class="'+c.barPlayed+'"></div></div><div class="'+c.time+" "+c.timeDuration+'"></div><div class="'+c.volume+'"><div class="'+c.volumeButton+'" title="'+b.strVolume+'"><a href="#">'+b.strVolume+'</a></div><div class="'+c.volumeAdjust+'"><div><div></div></div></div></div>');var q=o.find("."+c.bar),r=o.find("."+c.barPlayed),s=o.find("."+c.barLoaded),t=o.find("."+c.timeCurrent),u=o.find("."+c.timeDuration),v=o.find("."+c.volumeButton),w=o.find("."+c.volumeAdjust+" > div"),x=0,y=function(a){theRealEvent=e?a.originalEvent.touches[0]:a,p.currentTime=Math.round(p.duration*(theRealEvent.pageX-q.offset().left)/q.width())},z=function(a){theRealEvent=e?a.originalEvent.touches[0]:a,p.volume=Math.abs((theRealEvent.pageY-(w.offset().top+w.height()))/w.height())},A=function(){var a=setInterval(function(){return p.buffered.length<1||(s.width(p.buffered.end(0)/p.duration*100+"%"),void(Math.floor(p.buffered.end(0))>=Math.floor(p.duration)&&clearInterval(a)))},100)},B=p.volume,C=p.volume=.111;Math.round(1e3*p.volume)/1e3==C?p.volume=B:o.addClass(c.noVolume),u.html("&hellip;"),t.html(j(0)),p.addEventListener("loadeddata",function(){A(),u.html(a.isNumeric(p.duration)?j(p.duration):"&hellip;"),w.find("div").height(100*p.volume+"%"),x=p.volume}),p.addEventListener("timeupdate",function(){t.html(j(p.currentTime)),r.width(p.currentTime/p.duration*100+"%")}),p.addEventListener("volumechange",function(){w.find("div").height(100*p.volume+"%"),p.volume>0&&o.hasClass(c.muted)&&o.removeClass(c.muted),p.volume<=0&&!o.hasClass(c.muted)&&o.addClass(c.muted)}),p.addEventListener("ended",function(){o.removeClass(c.playing).addClass(c.stopped)}),q.on(f,function(a){y(a),q.on(g,function(a){y(a)})}).on(i,function(){q.unbind(g)}),v.on("click",function(){return o.hasClass(c.muted)?(o.removeClass(c.muted),p.volume=x):(o.addClass(c.muted),x=p.volume,p.volume=0),!1}),w.on(f,function(a){z(a),w.on(g,function(a){z(a)})}).on(i,function(){w.unbind(g)})}else o.addClass(c.mini);o.addClass(l?c.playing:c.stopped),o.find("."+c.playPause).on("click",function(){return o.hasClass(c.playing)?(a(this).attr("title",b.strPlay).find("a").html(b.strPlay),o.removeClass(c.playing).addClass(c.stopped),n?p.pause():p.Stop()):(a(this).attr("title",b.strPause).find("a").html(b.strPause),o.addClass(c.playing).removeClass(c.stopped),n?p.play():p.Play()),!1}),d.replaceWith(o)}),this}}(jQuery,window,document);